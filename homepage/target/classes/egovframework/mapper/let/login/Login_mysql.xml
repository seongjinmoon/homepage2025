<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovLoginDAO">

	
	<!-- 로그인 처리를 위한 resultMap -->
	<resultMap id="login" type="egovframework.com.cmm.LoginVO">
		<result property="id" column="EMPLYR_ID"/>
		<result property="name" column="USER_NM"/>
		<result property="ihidNum" column="IHIDNUM"/>
		<result property="email" column="EMAIL_ADRES"/>
		<result property="password" column="PASSWORD"/>
		<result property="userSe" column="userSe"/>
		<result property="orgnztId" column="ORGNZT_ID"/>
		<result property="uniqId" column="ESNTL_ID"/>		
	</resultMap>
	
	<!-- 아이디 찾기를 위한 resultMap -->
	<resultMap id="id" type="egovframework.com.cmm.LoginVO">
		<result property="id" column="id"/>
	</resultMap>
	
	<!-- 비밀번호 처리를 위한 resultMap -->
	<resultMap id="password" type="egovframework.com.cmm.LoginVO">
		<result property="password" column="password"/>
	</resultMap>
	
	
	<!-- 일반 로그인 -->
	<select id="egovLoginDAO.actionLogin" resultMap="login">
        SELECT EMPLYR_ID
             , USER_NM
             , PASSWORD
             , IHIDNUM
             , EMAIL_ADRES
             , 'USR' AS userSe
             , ORGNZT_ID
             , ESNTL_ID
          FROM LETTNEMPLYRINFO
         WHERE EMPLYR_ID = #{id}
           AND PASSWORD = #{password}
           AND EMPLYR_STTUS_CODE = 'P'
	</select>
	
	<!-- 아이디 찾기 -->
	<select id="egovLoginDAO.searchId" resultMap="id">
		SELECT emplyr_id AS id
		FROM LETTNEMPLYRINFO
		WHERE USER_NM = #{name}
		   AND EMAIL_ADRES = #{email}
		   AND EMPLYR_STTUS_CODE = 'P'
	</select>
	 
	<!-- 비밀번호 찾기 -->
	<select id="egovLoginDAO.searchPassword" resultMap="password">
		SELECT 
			PASSWORD AS password
		FROM LETTNEMPLYRINFO
		WHERE EMPLYR_ID = #{id}
		   AND USER_NM = #{name}
		   AND EMAIL_ADRES = #{email}
		   AND PASSWORD_CNSR = #{passwordCnsr}
		   AND EMPLYR_STTUS_CODE = 'P'
	</select>
	
	<!-- 변경된 비밀번호를 저장  -->
	<update id="egovLoginDAO.updatePassword">
		UPDATE LETTNEMPLYRINFO
		   SET PASSWORD = #{password}
		 WHERE EMPLYR_ID = #{id}
	</update>
	
</mapper>